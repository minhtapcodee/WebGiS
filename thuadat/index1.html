<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Bản đồ hiện trạng đất Việt Nam</title>
    <link rel="icon" type="image/png" href="vietnam.png" />

    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-search/dist/leaflet-search.min.css"
    />

    <!-- Font từ Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        margin: 0;
        font-family: "Roboto", sans-serif;
      }

      /* Thanh tiêu đề */
      .header {
        background-color: #2c3e50; /* Màu xanh giống GeoServer */
        padding: 10px 20px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .header-logo img {
        height: 40px; /* Kích thước logo */
      }

      .header-content {
        display: flex;
        align-items: center;
      }

      .header-title {
        color: white;
        font-size: 24px;
        font-weight: bold;
        margin-left: 20px;
      }

      .header-subtitle {
        color: white;
        font-size: 10px;
        font-style: italic;
        margin-left: 15px;
        margin-top: 5px;
      }

      /* Ô tìm kiếm */
      #search-container {
        position: absolute;
        top: 90px; /* Đẩy xuống để không đè lên header và subtitle */
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
        background-color: white;
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        display: flex; /* Để input và button nằm ngang */
      }

      #search-input {
        width: 300px;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 3px 0 0 3px;
        font-size: 14px;
      }

      #search-button {
        padding: 5px 10px;
        border: 1px solid #ccc;
        border-left: none;
        border-radius: 0 3px 3px 0;
        background-color: #f0f0f0;
        cursor: pointer;
        font-size: 14px;
      }

      #search-button:hover {
        background-color: #e0e0e0;
      }

      /* Bản đồ */
      #map {
        height: calc(100vh - 80px); /* Trừ chiều cao của header và subtitle */
        width: 100%;
        position: relative; /* Đảm bảo bản đồ hiển thị đúng */
      }

      /* Style cho highlight */
      .highlight {
        fill-color: #ff0000;
        fill-opacity: 0.5;
        color: #ff0000;
        weight: 2;
      }
    </style>
  </head>
  <body>
    <!-- Thanh tiêu đề -->
    <header class="header">
      <div class="header-content">
        <div class="header-logo">
          <!-- Thay bằng logo của bạn -->
          <img src="treasure-map.png" alt="Logo" />
        </div>
        <div>
          <div class="header-title">Bản đồ hiện trạng đất Việt Nam qua các năm</div>
          <div class="header-subtitle">
                 *Thuộc quyền sở hữu của Minh_code_ dạo và Leaflet
          </div>
        </div>
      </div>
    </header>

    <!-- Ô tìm kiếm -->
    <div id="search-container">
      <input
        type="text"
        id="search-input"
        placeholder="Nhập địa điểm cần tìm"
      />
      <button id="search-button">Tìm kiếm</button>
    </div>

    <!-- Bản đồ -->
    <div id="map"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-search@3.0.2/dist/leaflet-search.min.js"></script>

    <script>
      // Tạo bản đồ
      var map = L.map("map").setView([11.1667, 106.6667], 10); // Trung tâm Bình Dương

      // Thêm lớp nền OpenStreetMap
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "© OpenStreetMap contributors",
      }).addTo(map);

      // Tạo Layer cho ranh giới Bình Dương, Thuận An và Vĩnh Phú
      var boundariesLayer = new L.GeoJSON(null, {
        style: function (feature) {
          return {
            color: "#ffffff", // Màu của các ranh giới
            weight: 1,
            fillOpacity: 0.2,
          };
        },
        onEachFeature: function (feature, layer) {
          if (feature.properties.name === "Phường Vĩnh Phú") {
            // Thêm thẻ <a> cho Phường Vĩnh Phú
            layer.bindPopup(
              feature.properties.name +
                ' <br><a href="index.html" target="_blank">Thông tin về hiện trạng đất...</a>'
            );
          } else {
            layer.bindPopup(feature.properties.name);
          }
        },
      });

      // Dữ liệu GeoJSON của Bình Dương, Thuận An và Vĩnh Phú
      var vietnamBoundaries = {
        type: "FeatureCollection",
        features: [
          {
            type: "Feature",
            properties: {
              name: "Bình Dương",
            },
            geometry: {
              type: "Polygon",
              coordinates: [
                [
                  [106.5, 11.3], // Tây bắc (gần Tây Ninh)
                  [106.9, 11.3], // Đông bắc (gần Bình Phước)
                  [106.9, 10.8], // Đông nam (gần Đồng Nai)
                  [106.5, 10.8], // Tây nam (gần TP. HCM)
                  [106.5, 11.3], // Đóng vòng
                ],
              ],
            },
          },
          {
            type: "Feature",
            properties: {
              name: "Thành phố Thuận An",
            },
            geometry: {
              type: "Polygon",
              coordinates: [
                [
                  [106.67, 10.95], // Tây bắc (gần Thủ Dầu Một)
                  [106.75, 10.95], // Đông bắc (gần Dĩ An)
                  [106.75, 10.88], // Đông nam (gần Thủ Đức, TP. HCM)
                  [106.67, 10.88], // Tây nam (gần quận 12, TP. HCM)
                  [106.67, 10.95], // Đóng vòng
                ],
              ],
            },
          },
          {
            type: "Feature",
            properties: {
              name: "Phường Vĩnh Phú",
            },
            geometry: {
              type: "Polygon",
              coordinates: [
                [
                  [106.7, 10.94], // Tây bắc (gần Lái Thiêu)
                  [106.73, 10.94], // Đông bắc (gần Bình Hòa)
                  [106.73, 10.9], // Đông nam (gần TP. Thủ Đức)
                  [106.7, 10.9], // Tây nam (gần quận 12, TP. HCM)
                  [106.7, 10.94], // Đóng vòng
                ],
              ],
            },
          },
        ],
      };

      // Thêm dữ liệu GeoJSON vào Layer
      boundariesLayer.addData(vietnamBoundaries);
      map.addLayer(boundariesLayer);

      // Đoạn mã xử lý tìm kiếm
      document
        .getElementById("search-button")
        .addEventListener("click", function () {
          var searchText = document
            .getElementById("search-input")
            .value.trim()
            .toLowerCase();
          if (searchText) {
            var found = false;
            boundariesLayer.eachLayer(function (layer) {
              var feature = layer.feature;
              if (
                feature.properties.name.toLowerCase().indexOf(searchText) !== -1
              ) {
                found = true;
                // Di chuyển đến vị trí tìm thấy
                var latLng = layer.getBounds().getCenter(); // Lấy tọa độ trung tâm của ranh giới
                map.setView(latLng, 12);

                // Reset style của tất cả các layer trước khi làm nổi bật layer mới
                boundariesLayer.eachLayer(function (l) {
                  l.setStyle({
                    color: "#3388ff",
                    weight: 1,
                    fillColor: "#3388ff",
                    fillOpacity: 0.2,
                  });
                });

                // Làm nổi bật ranh giới tỉnh/thành phố/phường tìm thấy
                layer.setStyle({
                  color: "#ff0000",
                  weight: 2,
                  fillColor: "#ff0000",
                  fillOpacity: 0.5,
                });

                // Mở popup khi tìm thấy
                layer.openPopup();
              }
            });

            if (!found) {
              alert("Không tìm thấy tỉnh, thành phố hoặc phường nào.");
            }
          } else {
            alert("Vui lòng nhập tên tỉnh, thành phố hoặc phường.");
          }
        });
    </script>
  </body>
</html>